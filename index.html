<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TM1 Official Grade Reveal</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <style>
        /* Custom styles for the large grade display */
        .grade-number {
            font-family: 'Space Mono', 'Courier New', monospace;
            transition: color 0.5s ease-in-out;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }
        /* Style for the button background */
        #gradeButton {
            background-image: linear-gradient(145deg, #10b981 0%, #059669 100%);
            transition: transform 0.1s;
        }
        #gradeButton:active {
            transform: scale(0.98);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Space Mono', 'Courier New', 'monospace'],
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4 font-sans">

    <div id="appContainer" class="bg-white p-8 md:p-12 rounded-xl shadow-2xl w-full max-w-xl text-center">
        
        <!-- Headers and Messages -->
        <h1 class="text-4xl font-extrabold text-gray-900 mb-2">TM1 Grade</h1>
        <h2 class="text-xl font-semibold text-gray-700 mb-6">Class 1F, 1G & Block-E <br/>Engr. Tope Quimpo</h2>
        
        <p id="p1" class="text-lg font-medium text-indigo-600 mb-4"></p>
        <p id="p2" class="text-gray-500 mb-8">Enter your school email to access your grade.</p>

        <!-- Input and Status Area -->
        <div id="authArea" class="space-y-4">
            <div class="relative max-w-sm mx-auto">
                <input
                    type="text"
                    id="emailInput"
                    class="w-full py-3 px-4 pr-[150px] border-2 border-indigo-300 rounded-lg text-lg font-mono focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out lowercase"
                    placeholder="student.username"
                    autocomplete="off"
                    autocapitalize="off"
                >
                <span class="absolute right-0 top-0 h-full flex items-center pr-4 text-gray-400 font-mono text-sm pointer-events-none bg-white rounded-r-lg border-l border-indigo-300 pl-2">
                    @smctagum.edu.ph
                </span>
            </div>
            <p id="statusText" class="text-sm h-5 text-red-500 transition-opacity"></p>
        </div>

        <!-- Grade Reveal Content (Dynamic) -->
        <div id="revealArea" class="hidden flex flex-col items-center mt-10 space-y-8">
            <div id="catGifContainer" class="w-full max-w-xs h-40 bg-gray-200 rounded-xl overflow-hidden shadow-lg flex items-center justify-center">
                <!-- Cat GIF will be inserted here -->
            </div>
            
            <button 
                id="gradeButton" 
                class="w-full max-w-sm py-4 px-6 text-xl font-bold text-white rounded-xl shadow-xl hover:shadow-2xl transition duration-300 ease-in-out cursor-pointer"
                onclick="handleButtonClick()"
            >
                <span id="buttonLabel">Loading...</span>
            </button>

            <!-- Final Grade Display -->
            <div id="finalGradeDisplay" class="hidden">
                <p id="gradeValue" class="grade-number text-8xl font-extrabold mb-8 text-gray-900">0.00</p>
            </div>
            
            <!-- Final Message Box -->
            <div id="messageBox" class="hidden w-full p-6 text-left bg-indigo-50 border border-indigo-300 rounded-xl">
                <p id="messageContent" class="text-base text-gray-700 leading-relaxed"></p>
            </div>
        </div>

    </div>

    <script>
        // Global Constants
        // October 24, 2025 4:11:34pm GMT+8
        const BASE_TIME_MS = new Date('2025-10-24T17:15:00+08:00').getTime();
        const PASSING_GRADE = 74.50;
        
        // --- Hardcoded Student Grade Data ---
        // This array replaces the backend CSV file (d.csv) content.
        const csvData = [
{ ee: 'YWJhdGF5by50amtoeWxs', ne: 'VGogS2h5bGwgQWJhdGF5bw==', p:75.07, m: 78.24, f: 76, fn: 76.38, fo:71.64, s: 'B', d:4.74,t: 7 },
{ ee: 'YW5nLmNq', ne: 'Q0ogQW5n', p:64.31, m: 60.89, f: 58, fn: 57.63, fo:46.77, s: 'C', d:10.86,t: 4 },
{ ee: 'YXNpcy5sb3VyZW5jZQ==', ne: 'TG91cmVuY2UgQXNpcw==', p:89.86, m: 91.36, f: 82, fn: 81.83, fo:78.87, s: 'A', d:2.96,t: 9 },
{ ee: 'YmFpdGFuLm1hcmtvbmlldmluY2U=', ne: 'TWFyayBPbmllIFZpbmNlIEJhaXRhbg==', p:72.56, m: 67.74, f: 69, fn: 68.8, fo:61.59, s: 'C', d:7.21,t: 7 },
{ ee: 'YmFsZGFwYW4ubGVlYWxmcml0eg==', ne: 'TGVlIEFsZnJpdHogQmFsZGFwYW4=', p:57.61, m: 54.15, f: 61, fn: 60.93, fo:51.15, s: 'C', d:9.78,t: 7 },
{ ee: 'YmFzaWxpby5tYXJrbGF1cmVuY2U=', ne: 'TWFyayBMYXVyZW5jZSBCYXNpbGlv', p:60.93, m: 83.71, f: 73, fn: 73.26, fo:67.51, s: 'C', d:5.75,t: 10 },
{ ee: 'YmF5YmF5b24uZG9taXJpY2tpdmFu', ne: 'RG9taXJpY2sgSXZhbiBCYXliYXlvbg==', p:71.03, m: 65.1, f: 69, fn: 69.13, fo:62.03, s: 'C', d:7.1,t: 15 },
{ ee: 'YmluYWxhbmdiYW5nLmJyYW50ZG9u', ne: 'QnJhbnRkb24gQmluYWxhbmdiYW5n', p:90, m: 93.96, f: 87, fn: 87.34, fo:86.18, s: 'A', d:1.16,t: 5 },
{ ee: 'Y2FwYW5neWFyaWhhbi5qZXNzdGhvbnk=', ne: 'SmVzc3Rob255IENhcGFuZ3lhcmloYW4=', p:83.53, m: 81.81, f: 78, fn: 77.91, fo:73.67, s: 'B', d:4.24,t: 2 },
{ ee: 'Y29ybml0ZXMubWN0cmVsbGluZXJpb3Blcg==', ne: 'TWMgVHJlbGxpbmUgUmlvcGVyIENvcm5pdGVz', p:83.92, m: 87.28, f: 81, fn: 81.11, fo:77.92, s: 'A', d:3.19,t: 1 },
{ ee: 'ZW5yZXJhLnJhbGZmcmFuY2lz', ne: 'UmFsZiBGcmFuY2lzIEVucmVyYQ==', p:57.37, m: 63.48, f: 70, fn: 69.86, fo:62.99, s: 'C', d:6.87,t: 8 },
{ ee: 'ZW50ZXJvLmhlbnpobw==', ne: 'SGVuemhvIEVudGVybw==', p:62.77, m: 64.68, f: 70, fn: 69.78, fo:62.89, s: 'C', d:6.89,t: 8 },
{ ee: 'aGluYW1wYXMuam9obmxlZXdhcnJlbg==', ne: 'Sm9obiBMZWUgV2FycmVuIEhpbmFtcGFz', p:70.07, m: 74.91, f: 75, fn: 75.16, fo:70.02, s: 'B', d:5.14,t: 15 },
{ ee: 'aWxhd2EuZ2xlbmpheQ==', ne: 'R2xlbiBKYXkgSWxhd2E=', p:93.17, m: 94.3, f: 88, fn: 88.25, fo:87.39, s: 'A', d:0.86,t: 3 },
{ ee: 'am9zZS5qb2huY2FybG8=', ne: 'Sm9obiBDYXJsbyBKb3Nl', p:80.62, m: 81.23, f: 78, fn: 78.4, fo:74.32, s: 'B', d:4.08,t: 11 },
{ ee: 'bGFub3MubWlsYmVu', ne: 'TWlsYmVuIExhbm9z', p:59.02, m: 68.93, f: 73, fn: 72.56, fo:66.57, s: 'C', d:5.99,t: 11 },
{ ee: 'bWFub25nZ2FsLmtlbnRhbmRyZQ==', ne: 'S2VudCBBbmRyZSBNYW5vbmdnYWw=', p:92.51, m: 96.18, f: 89, fn: 89.44, fo:88.97, s: 'A', d:0.47,t: 3 },
{ ee: 'b3JnZWwuamFtZXM=', ne: 'SmFtZXMgT3JnZWw=', p:57.61, m: 59.02, f: 64, fn: 63.52, fo:54.59, s: 'C', d:8.93,t: 8 },
{ ee: 'cGFuZXMubW9pc2VzZGF2ZQ==', ne: 'TW9pc2VzIERhdmUgUGFuZXM=', p:74.86, m: 75.15, f: 75, fn: 75.4, fo:70.35, s: 'B', d:5.05,t: 10 },
{ ee: 'cGljYXIucm9iZXJ0', ne: 'Um9iZXJ0IFBpY2Fy', p:69.4, m: 68.62, f: 69, fn: 69.01, fo:61.87, s: 'C', d:7.14,t: 12 },
{ ee: 'cmFtYWRhLmZyaXR6ZGVuemVsZWlhbg==', ne: 'RnJpdHogRGVuemVsIEVpYW4gUmFtYWRh', p:65.98, m: 71.27, f: 70, fn: 70.44, fo:63.77, s: 'C', d:6.67,t: 8 },
{ ee: 'c2FsZW0uc2FtbWFuZHJl', ne: 'U2FtbSBBbmRyZSBTYWxlbQ==', p:60.25, m: 58.07, f: 62, fn: 61.76, fo:52.25, s: 'C', d:9.51,t: 5 },
{ ee: 'dGFuZGlnYW4uY2FybHJleW1hcmtqdWRl', ne: 'Q2FybCBSZXltYXJrIEp1ZGUgVGFuZGluZ2Fu', p:58.6, m: 65.01, f: 69, fn: 68.79, fo:61.57, s: 'C', d:7.22,t: 2 },
{ ee: 'YmFsaWd1YXQuemhhaXJhbWFl', ne: 'WmhhaXJhIE1hZSBCYWxpZ3VhdA==', p:68.08, m: 77.64, f: 73, fn: 73.31, fo:67.57, s: 'C', d:5.74,t: 1 },
{ ee: 'YnVyZGlvcy5wcmluY2Vzc2Fubg==', ne: 'UHJpbmNlc3MgQW5uIEJ1cmRpb3M=', p:61.06, m: 60.46, f: 69, fn: 68.89, fo:61.71, s: 'C', d:7.18,t: 11 },
{ ee: 'ZGVnYW1vLnN1bnNoaW5l', ne: 'U3Vuc2hpbmUgRGVnYW1v', p:74.69, m: 79.63, f: 73, fn: 72.92, fo:67.06, s: 'C', d:5.86,t: 2 },
{ ee: 'ZG9yb29uLmFtYW5kYXpvZWE=', ne: 'QW1hbmRhIFpvZWEgUGFjYXRhbmcgRG9yby1Pbg==', p:71.27, m: 64.11, f: 64, fn: 63.59, fo:54.67, s: 'C', d:8.92,t: 12 },
{ ee: 'ZW5jbHVuYS5yb3NlbWFyaWU=', ne: 'Um9zZW1hcmllIEVuY2x1bmE=', p:83.11, m: 84.19, f: 79, fn: 78.88, fo:74.96, s: 'A', d:3.92,t: 12 },
{ ee: 'amFjb2JlLmNocmlzdGluZW1hZQ==', ne: 'Q2hyaXN0aW5lIE1hZSBKYWNvYmU=', p:57.29, m: 58.61, f: 67, fn: 67.38, fo:59.7, s: 'C', d:7.68,t: 15 },
{ ee: 'anVtYXdhbi5zYW1hbnRoYXBlYXJs', ne: 'U2FtYW50aGEgUGVhcmwgSnVtYXdhbg==', p:89.53, m: 92.29, f: 84, fn: 84.33, fo:82.19, s: 'A', d:2.14,t: 3 },
{ ee: 'bGF5c29uLmppcmVo', ne: 'SmlyZWggTGF5c29u', p:68.17, m: 70.38, f: 71, fn: 70.55, fo:63.91, s: 'C', d:6.64,t: 14 },
{ ee: 'bHVnYW5hby5hbGplZGFseW4=', ne: 'QWxqZWRhbHluIEx1Z2FuYW8=', p:57.07, m: 58.86, f: 65, fn: 64.99, fo:56.54, s: 'C', d:8.45,t: 6 },
{ ee: 'bWFodW1hcy5pcmVuZQ==', ne: 'SXJlbmUgTWFodW1hcw==', p:81.03, m: 82.1, f: 80, fn: 80.35, fo:76.91, s: 'A', d:3.44,t: 14 },
{ ee: 'cGFjaXMuZGV2aWU=', ne: 'RGV2aWUgUGFjaXM=', p:91.33, m: 90.94, f: 81, fn: 81.28, fo:78.14, s: 'A', d:3.14,t: 9 },
{ ee: 'cGFuZGlhbi5tYXJyeXZhbmU=', ne: 'TWFycnkgVmFuZSBQYW5kaWFu', p:75.16, m: 75.97, f: 75, fn: 74.5, fo:69.15, s: 'B', d:5.35,t: 5 },
{ ee: 'cm9kcmlndWV6LmtoZWlzaGF2aGVuZWVjZQ==', ne: 'S2hlaXNoYSBWaGVuZWVjZSBSb2RyaWd1ZXo=', p:59.44, m: 65.7, f: 68, fn: 67.69, fo:60.11, s: 'C', d:7.58,t: 13 },
{ ee: 'c2Fqb3IubWFl', ne: 'TWFlIFNham9y', p:71.74, m: 68.51, f: 73, fn: 73.29, fo:67.54, s: 'C', d:5.75,t: 2 },
{ ee: 'c2Fsb25nYS5sYWR5bmljaG9sZWltYWZl', ne: 'TGFkeSBOaWNob2xlIEltYWZlIFNhbG9uZ2E=', p:55.03, m: 56.84, f: 62, fn: 61.62, fo:52.06, s: 'C', d:9.56,t: 9 },
{ ee: 'c29yb21pYS5qaGFzbWluZQ==', ne: 'Smhhc21pbmUgU29yb21pYQ==', p:63.89, m: 68.71, f: 69, fn: 68.95, fo:61.79, s: 'C', d:7.16,t: 7 },
{ ee: 'dmlsbGFudWV2YS5jaGxvZXN0YXJrZXppYWg=', ne: 'Q2hsb2UgU3RhciBLZXppYWggVmlsbGFudWV2YQ==', p:77.28, m: 78.43, f: 78, fn: 77.91, fo:73.67, s: 'B', d:4.24,t: 10 },
{ ee: 'eWJhbmV6LnNoZXJ5bg==', ne: 'U2hlcnluIFliYfFleg==', p:63.53, m: 64.64, f: 69, fn: 68.57, fo:61.28, s: 'C', d:7.29,t: 3 },
{ ee: 'YWxhYmEuamhvbmRlbG1hcg==', ne: 'SmhvbiBEZWxtYXIgQWxhYmE=', p:61.33, m: 47.24, f: 54, fn: 54.16, fo:42.17, s: 'C', d:11.99,t: 15 },
{ ee: 'bWVob3kuY2hlc3RlcmpvaG4=', ne: 'Q2hlc3RlciBKb2huIE1laG95', p:57.79, m: 50.84, f: 55, fn: 54.98, fo:43.25, s: 'C', d:11.73,t: 4 },
{ ee: 'YW1wb2xvcXVpby5nZW5hcmFnZW5l', ne: 'R2VuYXJhIEdlbmUgQW1wb2xvcXVpbw==', p:43.78, m: 41.97, f: 53, fn: 52.97, fo:40.59, s: 'C', d:12.38,t: 11 },
{ ee: 'ZmFsbGVyLmNoYXJsZXNzdGVwaGVu', ne: 'Q2hhcmxlcyBTdGVwaGVuIEZhbGxlcg==', p:83.53, m: 88.28, f: 83, fn: 83.12, fo:80.15, s: 'D', d:2.97,t: 3 },
{ ee: 'aGlsYW1vbi5raW5uZXRo', ne: 'S2lubmV0aCBIaWxhbW9u', p:88.64, m: 90.99, f: 82, fn: 81.98, fo:79.07, s: 'A', d:2.91,t: 14 },
{ ee: 'Y2FjYXlhbi5rYXJseW5yaHltZQ==', ne: 'S2FybHluIFJoeW1lIENhY2F5YW4=', p:81.92, m: 87.82, f: 82, fn: 81.6, fo:78.57, s: 'A', d:3.03,t: 1 },
{ ee: 'bWFkZWxvLmFsdGhlYWFtb3I=', ne: 'QWx0aGVhIEFtb3IgTWFkZWxv', p:82.64, m: 89.35, f: 79, fn: 78.93, fo:75.03, s: 'A', d:3.9,t: 5 },
{ ee: 'bHVsdS5heGVsbWVlbmFyZA==', ne: 'QXhlbCBNZWVuYXJkIEx1bHU=', p:81.89, m: 84.32, f: 78, fn: 77.72, fo:73.42, s: 'B', d:4.3,t: 15 },
{ ee: 'ZGFtYXNjby5tYXJjbGxveWQ=', ne: 'TWFyYyBMbG95ZCBEYW1hc2Nv', p:72.23, m: 82.56, f: 77, fn: 77.16, fo:72.68, s: 'B', d:4.48,t: 11 },
{ ee: 'ZGVsYXBlbmEuYWxqb24=', ne: 'QWxqb24gRGVsYSBQZfFh', p:80.05, m: 83.62, f: 77, fn: 76.67, fo:71.26, s: 'E', d:5.41,t: 4 },
{ ee: 'Z3JhZmlsby5tYWlrb2FiZWw=', ne: 'TWFpa28gQWJlbCBHcmFmaWxv', p:80.43, m: 86.27, f: 77, fn: 76.57, fo:71.9, s: 'B', d:4.67,t: 12 },
{ ee: 'cmV0dXRhcy5ydWVqYXk=', ne: 'UnVlIEpheSBSZXR1dGFz', p:74.03, m: 85.74, f: 76, fn: 76.04, fo:70.39, s: 'E', d:5.65,t: 10 },
{ ee: 'b2xpdmVyaW8uZHdlbmpvZGltYXJ5', ne: 'RHdlbiBKb2RpbWFyeSBPbGl2ZXJpbw==', p:81.86, m: 81.19, f: 76, fn: 75.98, fo:71.12, s: 'B', d:4.86,t: 6 },
{ ee: 'ZGFsYW5hbi5rZW50', ne: 'S2VudCBEYWxhbmFu', p:73.46, m: 76.25, f: 75, fn: 75.1, fo:69.1, s: 'E', d:6,t: 4 },
{ ee: 'Z2FzdGFyZG8uZGFyeWxzYW0=', ne: 'RGFyeWwgU2FtIEdhc3RhcmRv', p:80.09, m: 78.52, f: 75, fn: 74.5, fo:68.27, s: 'E', d:6.23,t: 7 },
{ ee: 'YmFsbGVzdGVyb3MubG9yZW56b2FudG9uaW8=', ne: 'TG9yZW56byBBbnRvbmlvIEJhbGxlc3Rlcm9z', p:80.13, m: 82.27, f: 73, fn: 72.58, fo:65.63, s: 'F', d:6.95,t: 5 },
{ ee: 'Y2FzaXBlLm1hcmtjaGFybGVz', ne: 'TWFyayBDaGFybGVzIENhc2lwZQ==', p:79.87, m: 77.88, f: 71, fn: 71.06, fo:63.53, s: 'F', d:7.53,t: 10 },
{ ee: 'cmViYWphLmplc3NhYmV0aA==', ne: 'SmVzc2EgQmV0aCBSZWJhamE=', p:68.23, m: 73.21, f: 71, fn: 70.93, fo:64.42, s: 'C', d:6.51,t: 13 },
{ ee: 'ZnVlbnRlcy5rZXJvbmVpbA==', ne: 'S2VybyBOZWlsIEZ1ZW50ZXM=', p:83.84, m: 90.51, f: 71, fn: 70.92, fo:63.34, s: 'F', d:7.58,t: 5 },
{ ee: 'cGVyb3NvLm1hcmZqaHVu', ne: 'TWFyZmpodW4gUGVyb3Nv', p:58.99, m: 66.1, f: 70, fn: 70.14, fo:63.36, s: 'C', d:6.78,t: 3 },
{ ee: 'YXBhcmVjZS5qYW1lc2RoaW4=', ne: 'SmFtZXMgRGhpbiBBcGFyZWNl', p:66.14, m: 59.14, f: 69, fn: 68.68, fo:61.43, s: 'C', d:7.25,t: 8 },
{ ee: 'cm9qZXJvLmNyaXNzYW5qZW5u', ne: 'Q3Jpc3NhbiBKZW5uIFJvamVybw==', p:77.62, m: 85.87, f: 69, fn: 68.6, fo:61.32, s: 'C', d:7.28,t: 7 },
{ ee: 'cGluaWxpLmt1cnRyYXplbA==', ne: 'S3VydCBSYXplbCBQaW5pbGk=', p:58.15, m: 62.69, f: 68, fn: 68.48, fo:61.16, s: 'C', d:7.32,t: 4 },
{ ee: 'dG9ub2cuY3V0ZXByaW5jZXNz', ne: 'Q3V0ZSBQcmluY2VzcyBUb25vZw==', p:58.16, m: 66.01, f: 68, fn: 68.13, fo:60.7, s: 'C', d:7.43,t: 2 },
{ ee: 'bWVsbG9taWRhLm5hdGhhbmllbA==', ne: 'TmF0aGFuaWVsIE1lbGxvbWlkYQ==', p:58.58, m: 71.03, f: 68, fn: 67.9, fo:59.17, s: 'F', d:8.73,t: 15 },
{ ee: 'YmVuZW1lcml0by5qYXlzb24=', ne: 'SmF5c29uIEJlbmVtZXJpdG8=', p:67.09, m: 68.04, f: 67, fn: 67.44, fo:59.79, s: 'C', d:7.65,t: 7 },
{ ee: 'cGVyaWFzLmpvZWJlbno=', ne: 'Sm9lIEJlbnogUGVyaWFz', p:62.81, m: 68.06, f: 66, fn: 66.47, fo:57.2, s: 'F', d:9.27,t: 12 },
{ ee: 'YXBlbG8uamF5aGFubmxsb3lk', ne: 'SmF5IEhhbm4gTGxveWQgQXBlbG8=', p:64.91, m: 67.56, f: 66, fn: 66.4, fo:58.4, s: 'C', d:8,t: 1 },
{ ee: 'YmFpZ3R1LnJvbmFtb3I=', ne: 'Um9uYW1vciBCYWlndHU=', p:55.41, m: 62.91, f: 66, fn: 66.2, fo:58.14, s: 'C', d:8.06,t: 12 },
{ ee: 'YXJpbmdveS5tZXJ2aW4=', ne: 'TWVydmluIEFyaW5nb3k=', p:55.96, m: 59.76, f: 66, fn: 65.73, fo:57.52, s: 'C', d:8.21,t: 12 },
{ ee: 'YmFjb3Jpby5lbGl6ZXI=', ne: 'RWxpemVyIEJhY29yaW8=', p:60.13, m: 63.74, f: 65, fn: 65.2, fo:55.46, s: 'F', d:9.74,t: 11 },
{ ee: 'Ym9uZ2EubGVhbmRyb2dpYW4=', ne: 'TGVhbmRybyBHaWFuIEJvbmdh', p:76.64, m: 71.72, f: 64, fn: 64.41, fo:55.77, s: 'C', d:8.64,t: 2 },
{ ee: 'YW1idWxvLm5hamVy', ne: 'TmFqZXIgQW1idWxv', p:61.07, m: 62.7, f: 64, fn: 64.21, fo:55.5, s: 'C', d:8.71,t: 10 },
{ ee: 'bWlndWVsLmt1cnQ=', ne: 'S3VydCBNaWd1ZWw=', p:58.44, m: 64, f: 64, fn: 64, fo:55.22, s: 'C', d:8.78,t: 8 },
{ ee: 'am9zZXJ5bGxiZXNvcmlv', ne: 'Sm9zZXJ5bGwgTGxveWQgQmVzb3Jpbw==', p:52.88, m: 51.53, f: 60, fn: 60.43, fo:50.49, s: 'C', d:9.94,t: 14 },
{ ee: 'c2FyZW5hcy5qb2hucmFvdWw=', ne: 'Sm9obiBSYW91bCBTYXJlbmFz', p:51.16, m: 50.85, f: 60, fn: 60.04, fo:48.34, s: 'F', d:11.7,t: 1 },
{ ee: 'bmF2YXJyby5jb2xpbmpvc2h1YQ==', ne: 'Q29saW4gSm9zaHVhIE5hdmFycm8=', p:54.28, m: 53.36, f: 59, fn: 58.91, fo:48.47, s: 'C', d:10.44,t: 4 },
{ ee: 'bGFkZXJhLmpvdmljanI=', ne: 'Sm92aWMgSnIuIExhZGVyYQ==', p:59.71, m: 57.32, f: 58, fn: 57.83, fo:47.04, s: 'C', d:10.79,t: 12 },
{ ee: 'dmVyZ2FyYS5hYmVnYWls', ne: 'QWJlZ2FpbCBWZXJnYXJh', p:50.93, m: 50.15, f: 58, fn: 57.51, fo:46.61, s: 'C', d:10.9,t: 9 },
{ ee: 'Ym9ob2wuYWx5emFqb3ljZQ==', ne: 'QWx5emEgSm95Y2UgQm9ob2w=', p:57.29, m: 55.57, f: 56, fn: 56.3, fo:45.01, s: 'C', d:11.29,t: 15 },
{ ee: 'Y2FiYWwubWF0dGNsYXJlbmNl', ne: 'TWF0dCBDbGFyZW5jZSBDYWJhbA==', p:57.91, m: 49.49, f: 56, fn: 56.05, fo:42.85, s: 'F', d:13.2,t: 6 },
{ ee: 'cGVybml0by5wcmluY2VoYXJyZWxzb24=', ne: 'UHJpbmNlIEhhcnJlbHNvbiBQZXJuaXRv', p:52.43, m: 48.15, f: 55, fn: 54.62, fo:42.78, s: 'C', d:11.84,t: 13 },
{ ee: 'cm9tYW5pbGxvcy5rYXRobGVlbg==', ne: 'S2F0aGxlZW4gUm9tYW5pbGxvcw==', p:85.15, m: 91.56, f: 87, fn: 87.44, fo:86.17, s: 'D', d:1.27,t: 1 },
{ ee: 'c2lsdmlkby5mcmVuenk=', ne: 'RnJlbnp5IFNpbHZpZG8=', p:89.08, m: 90.31, f: 86, fn: 86.37, fo:84.7, s: 'D', d:1.67,t: 14 },
{ ee: 'bWFydGluZXouYWlyYW1pbGt5amFuZQ==', ne: 'QWlyYSBNaWxreSBKYW5lIE1hcnRpbmV6', p:85, m: 79.97, f: 83, fn: 83.39, fo:80.6, s: 'D', d:2.79,t: 5 },
{ ee: 'b2Jlc28ucHJpbmNlc3NuaWV0c3pjaGVhbm5leQ==', ne: 'UHJpbmNlc3MgTmlldHN6Y2hlYW5uZXkgT2Jlc28=', p:82.95, m: 88.07, f: 82, fn: 82.14, fo:78.88, s: 'D', d:3.26,t: 4 },
{ ee: 'c2FuZ2lhbi5qZW12aWpoYW5l', ne: 'SmVtdmkgSmhhbmUgU2FuZ2lhbg==', p:80.6, m: 84.53, f: 82, fn: 81.99, fo:78.67, s: 'D', d:3.32,t: 8 },
{ ee: 'am9zZS5qdXN0aW5yb3ljZQ==', ne: 'SnVzdGluIFJveWNlIEpvc2U=', p:85.07, m: 90.36, f: 82, fn: 81.84, fo:78.47, s: 'D', d:3.37,t: 8 },
{ ee: 'Z3VsbGUucmFuZG9sZg==', ne: 'UmFuZG9sZiBHdWxsZQ==', p:71.51, m: 81.84, f: 81, fn: 80.91, fo:77.19, s: 'D', d:3.72,t: 2 },
{ ee: 'c3VheWJhZ3Vpby5jaHJpc3RpYW5qYXk=', ne: 'Q2hyaXN0aWFuIEpheSBTdWF5YmFndWlv', p:84.71, m: 86.3, f: 81, fn: 80.86, fo:77.12, s: 'D', d:3.74,t: 6 },
{ ee: 'am95Y2V0YWJhcXVpbg==', ne: 'Sm95Y2UgVGFiYXF1aW4=', p:78.1, m: 88.81, f: 81, fn: 80.61, fo:76.78, s: 'D', d:3.83,t: 3 },
{ ee: 'YmFkYXlvcy5tYXJ2aW5qYXk=', ne: 'TWFydmluIEpheSBCYWRheW9z', p:75.6, m: 78.34, f: 80, fn: 80.48, fo:76.6, s: 'D', d:3.88,t: 5 },
{ ee: 'b3JqYWxlemEuY2hyaXN0aWFu', ne: 'Q2hyaXN0aWFuIE9yamFsZXph', p:75.64, m: 83.94, f: 80, fn: 80.28, fo:76.32, s: 'D', d:3.96,t: 10 },
{ ee: 'Y2FoYXBheS50cmlzaGFtYWU=', ne: 'VHJpc2hhIE1hZSBDYWhhcGF5', p:79.09, m: 77.37, f: 80, fn: 80.19, fo:76.2, s: 'D', d:3.99,t: 3 },
{ ee: 'bm9sbGFzLmRvbGx5cm9zZQ==', ne: 'RG9sbHkgUm9zZSBOb2xsYXM=', p:83.73, m: 84.63, f: 80, fn: 79.85, fo:75.73, s: 'D', d:4.12,t: 1 },
{ ee: 'YmFuZGlvbGEubWFyeW1hbmVs', ne: 'TWFyeSBNYW5lbCBCYW5kaW9sYQ==', p:77.95, m: 82.54, f: 80, fn: 79.69, fo:75.51, s: 'D', d:4.18,t: 11 },
{ ee: 'Y2FsYWJpby5pY3k=', ne: 'SWN5IENhbGFiaW8=', p:79.39, m: 84.75, f: 79, fn: 79.13, fo:74.74, s: 'D', d:4.39,t: 2 },
{ ee: 'bWVkaW5hLmphcmVkam9uZXM=', ne: 'SmFyZWQgSm9uZXMgTWVkaW5h', p:84.16, m: 83.49, f: 79, fn: 78.93, fo:74.47, s: 'E', d:4.46,t: 4 },
{ ee: 'cGVyYWx0YS56eWFubmU=', ne: 'Wnlhbm5lIFBlcmFsdGE=', p:82.01, m: 82.47, f: 79, fn: 78.79, fo:74.27, s: 'E', d:4.52,t: 6 },
{ ee: 'c2FudGlsbGFuLmFiYnlnYWlsamFuZQ==', ne: 'QWJieWdhaWwgSmFuZSBTYW50aWxsYW4=', p:74.65, m: 80.96, f: 79, fn: 78.75, fo:74.21, s: 'E', d:4.54,t: 2 },
{ ee: 'YW1vcmVzLmphbWVzcmFmYWVs', ne: 'SmFtZXMgUmFmYWVsIEFtb3Jlcw==', p:69.82, m: 72.98, f: 78, fn: 78.16, fo:73.41, s: 'E', d:4.75,t: 8 },
{ ee: 'YmF0aGFsb24uamh1bGxz', ne: 'Smh1bGxzIEJhdGhhbG9u', p:77.48, m: 72.99, f: 78, fn: 78.1, fo:73.32, s: 'E', d:4.78,t: 15 },
{ ee: 'c3VnYXJvbC5lcmljaA==', ne: 'RXJpY2ggU3VnYXJvbA==', p:73.1, m: 78.24, f: 78, fn: 77.6, fo:72.64, s: 'E', d:4.96,t: 1 },
{ ee: 'bW9udGlib24uYWZmYWl0aA==', ne: 'QWxleGlhIEZhaXRoIE1vbnRpYm9u', p:82.63, m: 86.68, f: 77, fn: 77.47, fo:72.45, s: 'E', d:5.02,t: 12 },
{ ee: 'bWlncmluby5zaGVlbmFqb3k=', ne: 'U2hlZW5hIEpveSBNaWdyaW5v', p:72.99, m: 78.81, f: 77, fn: 77.45, fo:72.43, s: 'E', d:5.02,t: 8 },
{ ee: 'b3Jpbmdpbi5qZWFu', ne: 'SmVhbiBPcmluZ2lu', p:80.41, m: 80.04, f: 77, fn: 77.33, fo:72.26, s: 'E', d:5.07,t: 6 },
{ ee: 'ZHVsYXkuam9zdWVjeXJpbA==', ne: 'Sm9zdWUgQ3lyaWwgRHVsYXk=', p:70.79, m: 77.8, f: 77, fn: 76.62, fo:71.29, s: 'E', d:5.33,t: 1 },
{ ee: 'cGVuYXJhbmRhLnJlbWFyaw==', ne: 'UmVtYXJrIFBl8WFyYW5kYQ==', p:74.57, m: 75.45, f: 77, fn: 76.59, fo:71.24, s: 'E', d:5.35,t: 8 },
{ ee: 'bWFyaWFsLnZpbmNl', ne: 'VmluY2UgTWFyaWFs', p:73.34, m: 81.27, f: 77, fn: 76.56, fo:71.2, s: 'E', d:5.36,t: 3 },
{ ee: 'bHVtcG9uZy5saXphbWFl', ne: 'TGl6YSBNYWUgTHVtcG9uZw==', p:80.26, m: 85.34, f: 77, fn: 76.55, fo:71.19, s: 'E', d:5.36,t: 4 },
{ ee: 'ZGFsYXkuZnJpdHpjZWRyaWNr', ne: 'RnJpdHogQ2VkcmljayBEYWxheQ==', p:72.13, m: 73.5, f: 76, fn: 76.29, fo:70.83, s: 'E', d:5.46,t: 10 },
{ ee: 'Z3VpdG9uZXMuYWpjbGFyZW5jZQ==', ne: 'QWogQ2xhcmVuY2UgR3VpdG9uZXM=', p:78.7, m: 76.89, f: 76, fn: 75.61, fo:69.9, s: 'E', d:5.71,t: 5 },
{ ee: 'bW9tYmxhbmNvLmNoeW5h', ne: 'Q2h5bmEgTW9tYmxhbmNv', p:77.48, m: 75.99, f: 75, fn: 75.47, fo:69.7, s: 'E', d:5.77,t: 9 },
{ ee: 'bW9yYWxlcy5sag==', ne: 'TGogTW9yYWxlcw==', p:76.9, m: 77.43, f: 75, fn: 75.39, fo:69.6, s: 'E', d:5.79,t: 7 },
{ ee: 'Y2Fub3MubWFyeWNsYWlyZQ==', ne: 'TWFyeSBDbGFpcmUgQ2Hxb3M=', p:69.33, m: 70.77, f: 75, fn: 75.14, fo:69.25, s: 'E', d:5.89,t: 15 },
{ ee: 'dGltdGltLnJveGFuZQ==', ne: 'Um94YW5lIFRpbXRpbQ==', p:78.1, m: 75.48, f: 75, fn: 74.64, fo:68.56, s: 'E', d:6.08,t: 2 },
{ ee: 'Z2VuZXJvc2EubXlyYQ==', ne: 'TXlyYSBHZW5lcm9zYQ==', p:79.27, m: 78.3, f: 75, fn: 74.5, fo:68.37, s: 'E', d:6.13,t: 4 },
{ ee: 'ZWRwYWxpbmEucnV6ZWxsZWp1bGx6', ne: 'UnV6ZWxsZSBKdWxseiBFZHBhbGluYQ==', p:73.51, m: 79.5, f: 73, fn: 73.36, fo:66.8, s: 'F', d:6.56,t: 15 },
{ ee: 'bGFiYXN0aWRhLmRhaWljaGlqdW5l', ne: 'RGFpaWNoaSBKdW5lIExhYmFzdGlkYQ==', p:70.07, m: 70.83, f: 72, fn: 72.45, fo:65.55, s: 'F', d:6.9,t: 5 },
{ ee: 'YnV0YWxpZC5qYW5lbGxl', ne: 'SmFuZWxsZSBCdXRhbGlk', p:75.5, m: 74.91, f: 72, fn: 71.82, fo:64.69, s: 'F', d:7.13,t: 5 },
{ ee: 'am9obnJlbnphbGF5b24=', ne: 'Sm9obiBSZW56IEFsYXlvbg==', p:66.79, m: 73.92, f: 71, fn: 71.24, fo:63.89, s: 'F', d:7.35,t: 11 },
{ ee: 'amFuc29uLnBhdWxh', ne: 'UGF1bGEgSmFuc29u', p:65.65, m: 68.49, f: 71, fn: 70.75, fo:63.21, s: 'F', d:7.54,t: 6 },
{ ee: 'a3VyaWJheWFzaGkuaGlkZXl1a2k=', ne: 'SGlkZXl1a2kgS3VyaWJheWFzaGk=', p:63.64, m: 68.74, f: 71, fn: 70.74, fo:63.2, s: 'F', d:7.54,t: 9 },
{ ee: 'Z2FzY28ucGhlb25hbWFl', ne: 'UGhlb25hIE1hZSBHYXNjbw==', p:60.4, m: 62.21, f: 69, fn: 69.01, fo:60.82, s: 'F', d:8.19,t: 11 },
{ ee: 'YXJpbmdveS5tYXJjZ2lmZmVu', ne: 'TWFyYyBHaWZmZW4gQXJpbmdveQ==', p:69.7, m: 65.02, f: 69, fn: 68.96, fo:60.75, s: 'F', d:8.21,t: 2 },
{ ee: 'Y29yYmVsbGEuc3RlcGhhbmll', ne: 'U3RlcGhhbmllIENvcmJlbGxh', p:64.9, m: 59.09, f: 68, fn: 67.96, fo:59.38, s: 'F', d:8.58,t: 14 },
{ ee: 'bGluYXNhLnJleW5hbGRqcg==', ne: 'UmV5bmFsZCBKci4gTGluYXNh', p:71.31, m: 60.9, f: 67, fn: 67.32, fo:58.5, s: 'F', d:8.82,t: 14 },
{ ee: 'ZGFpcm8uYWx0aGVhbG9pc3Nl', ne: 'QWx0aGVhIExvaXNzZSBEYWlybw==', p:57.64, m: 58.04, f: 66, fn: 65.52, fo:56.02, s: 'F', d:9.5,t: 14 },
{ ee: 'YW50b3F1ZS5icnlsbGU=', ne: 'QnJ5bGxlIEFudG9xdWU=', p:70.42, m: 77.61, f: 62, fn: 62.08, fo:51.28, s: 'F', d:10.8,t: 2 },
{ ee: 'aWduYWxpZ2tlbm5ldGg0', ne: 'S2VubmV0aCBJZ25hbGln', p:60.49, m: 48.54, f: 56, fn: 55.74, fo:42.56, s: 'F', d:13.18,t: 9 },
{ ee: 'dGFqb3Jlcy5hY2VqZXJhbGQ=', ne: 'QWNlIEplcmFsZCBUYWpvcmVz', p:40, m: 40.84, f: 54, fn: 54.06, fo:40.25, s: 'F', d:13.81,t: 4 },
       ];

        // UI Elements
        const authArea = document.getElementById('authArea');
        const revealArea = document.getElementById('revealArea');
        const emailInput = document.getElementById('emailInput');
        const statusText = document.getElementById('statusText');
        const p1 = document.getElementById('p1');
        const p2 = document.getElementById('p2');
        const catGifContainer = document.getElementById('catGifContainer');
        const gradeButton = document.getElementById('gradeButton');
        const buttonLabel = document.getElementById('buttonLabel');
        const finalGradeDisplay = document.getElementById('finalGradeDisplay');
        const gradeValueText = document.getElementById('gradeValue');
        const messageBox = document.getElementById('messageBox');
        const messageContent = document.getElementById('messageContent');

        // State Variables
        let parsedData = null; // Stores the matching row data
        let countdownInterval = null;
        let buttonClickCount = 0;
        const buttonLabels = ["Proceed", "Brace Yourself", "Mao na jud ni", "🙈🙈🙈"];
        let isTimerZero = false; // Controls if the timer has reached zero/unlock time

        // --- Utility Functions ---

        const base64Decode = (str) => {
            try {
                // Remove leading/trailing spaces from the base64 string before decoding
                const cleanedStr = str.trim();
                return decodeURIComponent(atob(cleanedStr).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
            } catch (e) {
                console.error("Decoding error:", e);
                return null;
            }
        };

        const base64Encode = (str) => {
            // Encode the string without any leading/trailing spaces
            return btoa(unescape(encodeURIComponent(str.trim())));
        };

        const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        // --- Authentication and UI Locking ---

        function handleInput(event) {
            let value = event.target.value.toLowerCase();
            
            // 1. Force Lowercase
            if (event.target.value !== value) {
                event.target.value = value;
                return; // Re-run on corrected value
            }

            // 2. Validate Alphanumeric and Period only (and no space)
            const cleanedValue = value.replace(/[^a-z0-9.]/g, '');
            if (value !== cleanedValue) {
                event.target.value = cleanedValue;
                value = cleanedValue;
                // If a character was filtered, the subsequent base64 check will run with the corrected value
            }

            if (value.length === 0) {
                statusText.textContent = "";
                return;
            }

            // Encode the input (username only)
            const encodedEmail = base64Encode(value);
            
            // Search for the match
            const match = csvData.find(row => row.ee === encodedEmail);

            if (match) {
                parsedData = match;
                statusText.textContent = "Match found! Preparing your grade...";
                statusText.classList.remove('text-red-500');
                statusText.classList.add('text-green-600');
                lockInputAndStartReveal(match);
            } else {
                statusText.textContent = "No match found. Please check your username.";
                statusText.classList.remove('text-green-600');
                statusText.classList.add('text-red-500');
            }
        }

        function lockInputAndStartReveal(data) {
            // Lock and hide input
            emailInput.disabled = true;
            authArea.classList.add('hidden');
            revealArea.classList.remove('hidden');
            
            // Hide <h2> tag
            const h2Tag = document.querySelector('h2');
            if (h2Tag) {
            h2Tag.classList.add('hidden');
            }
            
            // Replace #p1 content with decoded name
            const decodedName = base64Decode(data.ne) || 'Student';
            p1.textContent = `${decodedName}!`;
            
            // Replace #p2 content
            p2.textContent = "A gen-z patience is a virtue. Cooking your grade.";
            
            // Insert random cat gif
            const catGifUrl = `https://cataas.com/cat/gif?${Date.now()}`;
            catGifContainer.innerHTML = `<img src="${catGifUrl}" onerror="this.src='https://placehold.co/300x160/cccccc/333333?text=Cat+Loading...'" class="w-full h-full object-cover rounded-xl" alt="Loading cat GIF">`;

            // Start the countdown
            startCountdown(data.t);
        }

        // --- Input Constraints Setup ---

        emailInput.addEventListener('input', handleInput);
        
        // Prevent pasting
        emailInput.addEventListener('paste', (e) => {
            e.preventDefault();
            // Using a custom message instead of alert per guidelines
            statusText.textContent = "Pasting is not allowed. Please type your username.";
            statusText.classList.remove('text-green-600');
            statusText.classList.add('text-red-500');
        });

        // --- Countdown Timer Logic (Refactored for Safety) ---

        function startCountdown(tValue) {
            const unlockDurationSeconds = tValue * 45;
            const unlockTimeMs = BASE_TIME_MS + (unlockDurationSeconds * 1000);
            
            // Initial check: determine if the timer has already elapsed
            const now = new Date().getTime();
            let initialRemainingTimeMs = unlockTimeMs - now;

            if (initialRemainingTimeMs <= 0) {
                // Case 1: Timer is already over or time value 't' is invalid/zero.
                isTimerZero = true;
                buttonLabel.textContent = "Ready na!";
                gradeButton.classList.add('bg-green-600', 'hover:bg-green-700');
                gradeButton.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                return; // Safely exit without starting an interval
            }

            // Case 2: Timer is active, set up the interval
            const updateTimer = () => {
                const currentTime = new Date().getTime();
                let remainingTimeMs = unlockTimeMs - currentTime;

                if (remainingTimeMs <= 0) {
                    remainingTimeMs = 0;
                    if (!isTimerZero) {
                        isTimerZero = true;
                        clearInterval(countdownInterval);
                        buttonLabel.textContent = "Ready na!";
                        gradeButton.classList.add('bg-green-600', 'hover:bg-green-700');
                        gradeButton.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                    }
                }

                // Format and update text (only if not zero, to avoid overwriting "Ready na!")
                if (!isTimerZero) {
                    const totalSeconds = Math.ceil(remainingTimeMs / 1000);
                    const minutes = Math.floor(totalSeconds / 60);
                    const seconds = totalSeconds % 60;
                    const formattedMinutes = String(minutes).padStart(3, '0');
                    const formattedSeconds = String(seconds).padStart(2, '0');
                    buttonLabel.textContent = `${formattedMinutes}:${formattedSeconds}`;
                }
            };

            updateTimer(); // Initial display update
            countdownInterval = setInterval(updateTimer, 1000);
        }

        // --- Button Click Handler ---

        function handleButtonClick() {
            if (!isTimerZero) {
                // Timer is still running (Premature click)
                statusText.textContent = "Patience is a virtue. howwat";
                statusText.classList.remove('text-green-600');
                statusText.classList.add('text-red-500');
                
                // Keep the status message visible for 2 seconds to ensure the user sees it
                setTimeout(() => {
                    statusText.textContent = "";
                }, 2000); 

                return;
            }
            
            statusText.textContent = ""; // Clear status message after unlocking

            // Timer is zero (unlocked)
            if (buttonClickCount < buttonLabels.length) {
                // Cycle through labels
                buttonLabel.textContent = buttonLabels[buttonClickCount];
                buttonClickCount++;
            } else {
                // Final click logic
                finalizeReveal();
            }
        }

        // --- Final Reveal Logic ---

        async function finalizeReveal() {
            // 1. Clean up UI
            p2.remove();
            catGifContainer.remove();
            gradeButton.classList.add('hidden');
            
            // 2. Show Grade Display
            finalGradeDisplay.classList.remove('hidden');
            
            // 3. Start Animation
            await animateGrade(parsedData.fn);
            
            // 4. Show Final Message
            displayFinalMessage(parsedData);
        }
        
        // --- Grade Animation Logic ---
        
        const JUMP_SEQUENCE = [
            [96.44, 7000, 500],
            [69.77, 5000, 200],
            [88.98, 4400, 300],
            [70.01, 3900, 200],
            [75.29, 3000, 100],
            [73.99, 4500, 500],
            [74.51, 4000, 700],
            [74.49, 1000, 1000],
            [70.13, 2000, 1500],
            [74.47, 3000, 1200],
            [75.01, 1000, 1200],
            [74.44, 2000, 1000]
        ];

        /**
         * Custom ease-out function for "momentum" (start fast, slow down).
         * @param {number} t - Time elapsed normalized (0 to 1).
         * @returns {number} Eased value.
         */


        function updateGradeColor(value) {
            if (value >= PASSING_GRADE) {
                gradeValueText.classList.remove('text-red-600');
                gradeValueText.classList.add('text-green-600');
            } else {
                gradeValueText.classList.remove('text-green-600');
                gradeValueText.classList.add('text-red-600');
            }
        }
        function easeOutQuad(t, factor = 100) {  // Factor controls the curve intensity
            return 1 - Math.pow(1 - t, 2 * factor);  // Proper easing calculation
        }        
        async function animateGrade(finalGrade) {
            let currentValue = 0.00;
            updateGradeColor(currentValue);

            const interpolate = (start, end, duration) => {
            const startTime = performance.now();
            const diff = end - start;
            
            return new Promise(resolve => {
                const step = (timestamp) => {
                const elapsed = timestamp - startTime;
                const normalizedTime = Math.min(elapsed / duration, 1);
                
                // Apply Easing Function for momentum with factor
                const easedTime = easeOutQuad(normalizedTime, 2.5);  // You can adjust this value
                
                // Calculate Eased Value
                currentValue = start + diff * easedTime;
                
                // Use toFixed(2) for grade display
                gradeValueText.textContent = currentValue.toFixed(2);
                updateGradeColor(currentValue);

                if (normalizedTime < 1) {
                    requestAnimationFrame(step);
                } else {
                    // Ensure the value hits the exact end point after animation
                    gradeValueText.textContent = end.toFixed(2);
                    updateGradeColor(end);
                    resolve();
                }
                };
                requestAnimationFrame(step);
            });
            };

            if (finalGrade < PASSING_GRADE) {
                // FN < 74.50: Increment from 0.00 to FN over 8 seconds.
                await interpolate(0.00, finalGrade, 8000);
            } else {
                // FN >= 74.50: Complex jump sequence
                
                for (const [target, duration, pause] of JUMP_SEQUENCE) {
                    const start = currentValue;
                    await interpolate(start, target, duration);
                    await sleep(pause);
                    currentValue = target;
                }

                // Final transition to FN value for 6 seconds
                await interpolate(currentValue, finalGrade, 6000);
                
                // Confetti pop
                confetti({
                    particleCount: 200,
                    spread: 80,
                    origin: { y: 0.6 }
                });
            }
            // Ensure final value is set correctly one last time
            gradeValueText.textContent = finalGrade.toFixed(2);
            updateGradeColor(finalGrade);
        }

        // --- Final Message Generation ---

        function displayFinalMessage(data) {
            const decodedName = base64Decode(data.ne) || 'Student';
            const ne = decodedName;
            const p = data.p.toFixed(2);
            const m = data.m.toFixed(2);
            const f = data.f;
            const fo = data.fo.toFixed(2);
            const d = data.d.toFixed(2);
            
            let message = '';

            // Note: The 'f' value is an integer (no decimal places required in the prompt), so we use 'f' directly.
            switch (data.s) {
                case 'A':
                    message = `Congratulations, **${ne}**! Your strong performance in TM1 is a great start. Given your consistency, you have a high potential for success in this course and the engineering program. Remember, college academics demand continuous effort; the next subjects will be significantly more challenging (and not forgiving). Keep this excellent momentum!

Your final grade will be rounded off to **${f}%**.
(Your original grade before adjustment was ${fo}%.)`; break;
                case 'B':
                    message = `Good work, **${ne}**. You've successfully passed this subject! However, passing was made possible by a necessary grade adjustment from an initial grade of ${fo}% (which was a failing mark). This highlights the need for a significant increase in your commitment. University-level engineering is rigorous, and the upcoming subjects will be much more demanding. **You must double your effort** starting now to build a strong foundation for the future.

Your final grade will be rounded off to **${f}%**.`;
                    break;
                case 'C':
                    message = `**${ne}**, your grade indicates serious challenges in this subject. The engineering path demands significant **perseverance and a high level of commitment and not forgiving**. Now is the essential time for critical self-reflection. I urge you to seriously evaluate if this course aligns with your passion and capacity, as the next subjects will only become more rigorous.

Your original performance was challenging, with your Prelim (${p}%) and Midterm (${m}%) scores being so low. I was able to apply mercy as much as only +${d}% but still is not enough, from an original grade of **${fo}%**.

Your final grade will be rounded off to **${f}%**. Please use this time wisely to consider your next academic choices.`;
                    break;
                case 'D': // Grouping A and D since they share the same message structure
                    message = `Congratulations on your perseverance, **${ne}**! You've successfully passed this subject and can now advance to the next set of demanding courses. Please take your past experience as valuable learning. Remember, failure is costly in terms of time, money, and energy. **Commit to studying effectively** and building on this success.

Your final grade will be rounded off to **${f}%**.
(Your original grade before adjustment was ${fo}%.)`;
                    break;
                case 'E': // Grouping B and E since they share the same message structure
                    message = `**${ne}**, you've passed this subject, but I want to be transparent: your success was achieved through a grade adjustment from an initial score of ${fo}% (a failing mark). While you can now proceed, you must realize the increasing difficulty of the next subjects. Time is a finite resource, and **you need to significantly intensify your study habits** to avoid repeating this cycle. Learn from past failures and prioritize your academic future.

Your final grade will be rounded off to **${f}%**.`;
                    break;
                case 'F': // Grouping C and F since they share the same message structure
                    message = `**${ne}**, this repetitive failure signals a critical point for reflection. The demands of an engineering career require deep dedication. Time lost is a serious issue. I strongly advise you to **seriously consider your long-term academic and life choices**. Is this demanding program truly for you?

Your performance showed a low foundation, with your Prelim (${p}%) and Midterm (${m}%) scores being low. Your original grade was **${fo}%**, and I could only stretch it as much as +${d}%. The upcoming subjects are more difficult and less forgiving.

Your final adjusted grade is **${f}%**. You must ponder what changes are necessary for your future.`;
                    break;
                default:
                    message = `An error occurred with grade status. Please contact the administrator.`;
            }

            // Convert markdown-like bold to HTML for rendering
            messageContent.innerHTML = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            messageBox.classList.remove('hidden');
        }

        // --- Initialization ---
        // Since the data is hardcoded, no external loading is required.

    </script>
</body>
</html>
